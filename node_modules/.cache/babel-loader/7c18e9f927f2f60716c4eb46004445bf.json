{"ast":null,"code":"import _classCallCheck from \"/Users/weili/work/mobile-next/golang/src/github.com/aerogear/mobile-developer-console/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/weili/work/mobile-next/golang/src/github.com/aerogear/mobile-developer-console/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport axios from 'axios';\nimport { map } from 'lodash-es';\nvar OpenShiftWatchEvents = Object.freeze({\n  MODIFIED: 'MODIFIED',\n  ADDED: 'ADDED',\n  DELETED: 'DELETED',\n  OPENED: 'OPENED',\n  CLOSED: 'CLOSED'\n});\n\nvar OpenShiftWatchEventListener =\n/*#__PURE__*/\nfunction () {\n  function OpenShiftWatchEventListener(socket) {\n    _classCallCheck(this, OpenShiftWatchEventListener);\n\n    this._handler = function () {};\n\n    this._errorHandler = function () {};\n\n    this._socket = socket;\n  }\n\n  _createClass(OpenShiftWatchEventListener, [{\n    key: \"init\",\n    value: function init() {\n      var _this = this;\n\n      this._socket.onmessage = function (event) {\n        var data = JSON.parse(event.data);\n\n        _this._handler({\n          type: data.type,\n          payload: data.object\n        });\n      };\n\n      this._socket.oncreate = function () {\n        return _this._handler({\n          type: OpenShiftWatchEvents.OPENED\n        });\n      };\n\n      this._socket.onclose = function () {\n        return _this._handler({\n          type: OpenShiftWatchEvents.CLOSED\n        });\n      };\n\n      this._socket.onerror = function (err) {\n        return _this._errorHandler(err);\n      };\n\n      return this;\n    }\n  }, {\n    key: \"onEvent\",\n    value: function onEvent(handler) {\n      this._handler = handler;\n      return this;\n    }\n  }, {\n    key: \"catch\",\n    value: function _catch(handler) {\n      this._errorHandler = handler;\n      return this;\n    }\n  }]);\n\n  return OpenShiftWatchEventListener;\n}();\n\nvar getNamespace = function getNamespace() {\n  if (window && window.OPENSHIFT_CONFIG && window.OPENSHIFT_CONFIG.mdcNamespace) {\n    return window.OPENSHIFT_CONFIG.mdcNamespace;\n  }\n\n  return undefined;\n};\n\nvar getMasterUri = function getMasterUri() {\n  if (window && window.OPENSHIFT_CONFIG && window.OPENSHIFT_CONFIG.masterUri) {\n    return window.OPENSHIFT_CONFIG.masterUri;\n  }\n\n  return undefined;\n};\n\nvar getUser = function getUser() {\n  if (window.OPENSHIFT_CONFIG && window.OPENSHIFT_CONFIG.user) {\n    return Promise.resolve(Object.freeze(window.OPENSHIFT_CONFIG.user));\n  }\n\n  return Promise.reject(new Error('no user found'));\n};\n\nvar get = function get(res, name) {\n  return getUser().then(function (user) {\n    return axios({\n      url: \"\".concat(window.OPENSHIFT_CONFIG.masterUri, \"/apis/\").concat(res.group, \"/\").concat(res.version, \"/namespaces/\").concat(res.namespace, \"/\").concat(res.name, \"/\").concat(name),\n      headers: {\n        authorization: \"Bearer \".concat(user.accessToken)\n      }\n    }).then(function (response) {\n      return response.data;\n    });\n  });\n};\n\nvar update = function update(res, obj) {\n  return getUser().then(function (user) {\n    var requestUrl = _buildRequestUrl(res);\n\n    if (!obj.apiVersion) {\n      obj.apiVersion = res.group ? \"\".concat(res.group, \"/\").concat(res.version) : res.version;\n    }\n\n    return axios({\n      url: \"\".concat(requestUrl, \"/\").concat(obj.metadata.name),\n      method: 'PUT',\n      data: obj,\n      headers: {\n        authorization: \"Bearer \".concat(user.accessToken)\n      }\n    }).then(function (response) {\n      return response.data;\n    });\n  });\n};\n\nvar list = function list(res) {\n  return getUser().then(function (user) {\n    return axios({\n      url: _buildRequestUrl(res),\n      headers: {\n        authorization: \"Bearer \".concat(user.accessToken)\n      }\n    }).then(function (response) {\n      return response.data;\n    });\n  });\n};\n\nvar create = function create(res, obj) {\n  return getUser().then(function (user) {\n    var requestUrl = _buildRequestUrl(res);\n\n    if (!obj.apiVersion) {\n      obj.apiVersion = res.group ? \"\".concat(res.group, \"/\").concat(res.version) : res.version;\n    }\n\n    if (!obj.kind && res.kind) {\n      obj.kind = res.kind;\n    }\n\n    return axios({\n      url: requestUrl,\n      method: 'POST',\n      data: obj,\n      headers: {\n        authorization: \"Bearer \".concat(user.accessToken)\n      }\n    }).then(function (response) {\n      return response.data;\n    });\n  });\n};\n\nvar remove = function remove(res, obj) {\n  return getUser().then(function (user) {\n    var requestUrl = _buildRequestUrl(res);\n\n    if (!obj.apiVersion) {\n      obj.apiVersion = res.group ? \"\".concat(res.group, \"/\").concat(res.version) : res.version;\n    }\n\n    if (!obj.kind && res.kind) {\n      obj.kind = res.kind;\n    }\n\n    return axios({\n      url: \"\".concat(requestUrl, \"/\").concat(obj.metadata.name),\n      method: 'DELETE',\n      data: {\n        apiVersion: obj.apiVersion,\n        kind: 'DeleteOptions',\n        propogationPolicy: 'Foreground'\n      },\n      headers: {\n        authorization: \"Bearer \".concat(user.accessToken)\n      }\n    }).then(function (response) {\n      return response.data;\n    });\n  });\n};\n\nvar watch = function watch(res) {\n  return getUser().then(function (user) {\n    var watchUrl = _buildWatchUrl(res);\n\n    var base64token = window.btoa(user.accessToken).replace(/=/g, '');\n    var socket = new WebSocket(watchUrl, [\"base64url.bearer.authorization.k8s.io.\".concat(base64token), null]);\n    return Promise.resolve(new OpenShiftWatchEventListener(socket).init());\n  });\n};\n\nvar listWithLabels = function listWithLabels(res, labels) {\n  var reqUrl = _buildRequestUrl(res);\n\n  if (labels) {\n    reqUrl = \"\".concat(reqUrl, \"?labelSelector=\").concat(_labelsToQuery(labels));\n  }\n\n  return getUser().then(function (user) {\n    axios({\n      url: reqUrl,\n      headers: {\n        authorization: \"Bearer \".concat(user.accessToken)\n      }\n    }).then(function (response) {\n      return response.data;\n    });\n  });\n};\n\nvar _buildOpenshiftApiUrl = function _buildOpenshiftApiUrl(baseUrl, res) {\n  return res.group ? \"\".concat(baseUrl, \"/apis/\").concat(res.group) : \"\".concat(baseUrl, \"/api\");\n};\n\nvar _buildOpenShiftUrl = function _buildOpenShiftUrl(baseUrl, res) {\n  var urlBegin = \"\".concat(_buildOpenshiftApiUrl(baseUrl, res), \"/\").concat(res.version);\n\n  if (res.namespace) {\n    return \"\".concat(urlBegin, \"/namespaces/\").concat(res.namespace, \"/\").concat(res.name);\n  }\n\n  return \"\".concat(urlBegin, \"/\").concat(res.name);\n};\n\nvar _buildRequestUrl = function _buildRequestUrl(res) {\n  return \"\".concat(_buildOpenShiftUrl(window.OPENSHIFT_CONFIG.masterUri, res));\n};\n\nvar _buildWatchUrl = function _buildWatchUrl(res) {\n  return \"\".concat(_buildOpenShiftUrl(window.OPENSHIFT_CONFIG.wssMasterUri, res), \"?watch=true\");\n};\n\nvar _labelsToQuery = function _labelsToQuery(labels) {\n  var labelsArr = map(labels, function (value, name) {\n    return \"\".concat(name, \"%3D\").concat(value);\n  });\n  return labelsArr.join(',');\n};\n\nexport { get, create, list, watch, update, remove, OpenShiftWatchEvents, getUser, listWithLabels, getNamespace, getMasterUri };","map":{"version":3,"sources":["/Users/weili/work/mobile-next/golang/src/github.com/aerogear/mobile-developer-console/src/services/openshift.js"],"names":["axios","map","OpenShiftWatchEvents","Object","freeze","MODIFIED","ADDED","DELETED","OPENED","CLOSED","OpenShiftWatchEventListener","socket","_handler","_errorHandler","_socket","onmessage","event","data","JSON","parse","type","payload","object","oncreate","onclose","onerror","err","handler","getNamespace","window","OPENSHIFT_CONFIG","mdcNamespace","undefined","getMasterUri","masterUri","getUser","user","Promise","resolve","reject","Error","get","res","name","then","url","group","version","namespace","headers","authorization","accessToken","response","update","obj","requestUrl","_buildRequestUrl","apiVersion","metadata","method","list","create","kind","remove","propogationPolicy","watch","watchUrl","_buildWatchUrl","base64token","btoa","replace","WebSocket","init","listWithLabels","labels","reqUrl","_labelsToQuery","_buildOpenshiftApiUrl","baseUrl","_buildOpenShiftUrl","urlBegin","wssMasterUri","labelsArr","value","join"],"mappings":"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","sourcesContent":["import axios from 'axios';\nimport { map } from 'lodash-es';\n\nconst OpenShiftWatchEvents = Object.freeze({\n  MODIFIED: 'MODIFIED',\n  ADDED: 'ADDED',\n  DELETED: 'DELETED',\n  OPENED: 'OPENED',\n  CLOSED: 'CLOSED'\n});\n\nclass OpenShiftWatchEventListener {\n  _handler = () => {};\n  _errorHandler = () => {};\n\n  constructor(socket) {\n    this._socket = socket;\n  }\n\n  init() {\n    this._socket.onmessage = event => {\n      const data = JSON.parse(event.data);\n      this._handler({ type: data.type, payload: data.object });\n    };\n    this._socket.oncreate = () => this._handler({ type: OpenShiftWatchEvents.OPENED });\n    this._socket.onclose = () => this._handler({ type: OpenShiftWatchEvents.CLOSED });\n    this._socket.onerror = err => this._errorHandler(err);\n    return this;\n  }\n\n  onEvent(handler) {\n    this._handler = handler;\n    return this;\n  }\n\n  catch(handler) {\n    this._errorHandler = handler;\n    return this;\n  }\n}\n\nconst getNamespace = () => {\n  if (window && window.OPENSHIFT_CONFIG && window.OPENSHIFT_CONFIG.mdcNamespace) {\n    return window.OPENSHIFT_CONFIG.mdcNamespace;\n  }\n  return undefined;\n};\n\nconst getMasterUri = () => {\n  if (window && window.OPENSHIFT_CONFIG && window.OPENSHIFT_CONFIG.masterUri) {\n    return window.OPENSHIFT_CONFIG.masterUri;\n  }\n  return undefined;\n};\n\nconst getUser = () => {\n  if (window.OPENSHIFT_CONFIG && window.OPENSHIFT_CONFIG.user) {\n    return Promise.resolve(Object.freeze(window.OPENSHIFT_CONFIG.user));\n  }\n  return Promise.reject(new Error('no user found'));\n};\n\nconst get = (res, name) =>\n  getUser().then(user =>\n    axios({\n      url: `${window.OPENSHIFT_CONFIG.masterUri}/apis/${res.group}/${res.version}/namespaces/${res.namespace}/${\n        res.name\n      }/${name}`,\n      headers: {\n        authorization: `Bearer ${user.accessToken}`\n      }\n    }).then(response => response.data)\n  );\n\nconst update = (res, obj) =>\n  getUser().then(user => {\n    const requestUrl = _buildRequestUrl(res);\n\n    if (!obj.apiVersion) {\n      obj.apiVersion = res.group ? `${res.group}/${res.version}` : res.version;\n    }\n\n    return axios({\n      url: `${requestUrl}/${obj.metadata.name}`,\n      method: 'PUT',\n      data: obj,\n      headers: {\n        authorization: `Bearer ${user.accessToken}`\n      }\n    }).then(response => response.data);\n  });\n\nconst list = res =>\n  getUser().then(user =>\n    axios({\n      url: _buildRequestUrl(res),\n      headers: {\n        authorization: `Bearer ${user.accessToken}`\n      }\n    }).then(response => response.data)\n  );\n\nconst create = (res, obj) =>\n  getUser().then(user => {\n    const requestUrl = _buildRequestUrl(res);\n\n    if (!obj.apiVersion) {\n      obj.apiVersion = res.group ? `${res.group}/${res.version}` : res.version;\n    }\n    if (!obj.kind && res.kind) {\n      obj.kind = res.kind;\n    }\n\n    return axios({\n      url: requestUrl,\n      method: 'POST',\n      data: obj,\n      headers: {\n        authorization: `Bearer ${user.accessToken}`\n      }\n    }).then(response => response.data);\n  });\n\nconst remove = (res, obj) =>\n  getUser().then(user => {\n    const requestUrl = _buildRequestUrl(res);\n\n    if (!obj.apiVersion) {\n      obj.apiVersion = res.group ? `${res.group}/${res.version}` : res.version;\n    }\n    if (!obj.kind && res.kind) {\n      obj.kind = res.kind;\n    }\n\n    return axios({\n      url: `${requestUrl}/${obj.metadata.name}`,\n      method: 'DELETE',\n      data: {\n        apiVersion: obj.apiVersion,\n        kind: 'DeleteOptions',\n        propogationPolicy: 'Foreground'\n      },\n      headers: {\n        authorization: `Bearer ${user.accessToken}`\n      }\n    }).then(response => response.data);\n  });\n\nconst watch = res =>\n  getUser().then(user => {\n    const watchUrl = _buildWatchUrl(res);\n    const base64token = window.btoa(user.accessToken).replace(/=/g, '');\n    const socket = new WebSocket(watchUrl, [`base64url.bearer.authorization.k8s.io.${base64token}`, null]);\n\n    return Promise.resolve(new OpenShiftWatchEventListener(socket).init());\n  });\n\nconst listWithLabels = (res, labels) => {\n  let reqUrl = _buildRequestUrl(res);\n  if (labels) {\n    reqUrl = `${reqUrl}?labelSelector=${_labelsToQuery(labels)}`;\n  }\n  return getUser().then(user => {\n    axios({\n      url: reqUrl,\n      headers: {\n        authorization: `Bearer ${user.accessToken}`\n      }\n    }).then(response => response.data);\n  });\n};\n\nconst _buildOpenshiftApiUrl = (baseUrl, res) => (res.group ? `${baseUrl}/apis/${res.group}` : `${baseUrl}/api`);\n\nconst _buildOpenShiftUrl = (baseUrl, res) => {\n  const urlBegin = `${_buildOpenshiftApiUrl(baseUrl, res)}/${res.version}`;\n  if (res.namespace) {\n    return `${urlBegin}/namespaces/${res.namespace}/${res.name}`;\n  }\n  return `${urlBegin}/${res.name}`;\n};\n\nconst _buildRequestUrl = res => `${_buildOpenShiftUrl(window.OPENSHIFT_CONFIG.masterUri, res)}`;\n\nconst _buildWatchUrl = res => `${_buildOpenShiftUrl(window.OPENSHIFT_CONFIG.wssMasterUri, res)}?watch=true`;\n\nconst _labelsToQuery = labels => {\n  const labelsArr = map(labels, (value, name) => `${name}%3D${value}`);\n  return labelsArr.join(',');\n};\n\nexport {\n  get,\n  create,\n  list,\n  watch,\n  update,\n  remove,\n  OpenShiftWatchEvents,\n  getUser,\n  listWithLabels,\n  getNamespace,\n  getMasterUri\n};\n"]},"metadata":{},"sourceType":"module"}