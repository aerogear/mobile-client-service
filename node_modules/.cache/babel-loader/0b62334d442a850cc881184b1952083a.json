{"ast":null,"code":"import _objectSpread from \"/Users/weili/work/mobile-next/golang/src/github.com/aerogear/mobile-developer-console/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _classCallCheck from \"/Users/weili/work/mobile-next/golang/src/github.com/aerogear/mobile-developer-console/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/weili/work/mobile-next/golang/src/github.com/aerogear/mobile-developer-console/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport { find, filter, reduce, uniqBy } from 'lodash-es';\nimport { newCustomResource, newCustomResourceClass } from './customresourcefactory';\nexport var MobileService =\n/*#__PURE__*/\nfunction () {\n  function MobileService() {\n    var json = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    _classCallCheck(this, MobileService);\n\n    this.data = json;\n    this.configuration = this.data.configuration || [];\n    this.configurationExt = this.data.configurationExt || [];\n    this.setupText = '';\n\n    if (this.data.bindCustomResource) {\n      this.customResourceClass = newCustomResourceClass(this.data.bindCustomResource.kind);\n    }\n\n    this.customResources = [];\n\n    if (this.data.customResources) {\n      var _iteratorNormalCompletion = true;\n      var _didIteratorError = false;\n      var _iteratorError = undefined;\n\n      try {\n        for (var _iterator = this.data.customResources[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n          var customResource = _step.value;\n          this.customResources.push(newCustomResource(customResource));\n        }\n      } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion && _iterator.return != null) {\n            _iterator.return();\n          }\n        } finally {\n          if (_didIteratorError) {\n            throw _iteratorError;\n          }\n        }\n      }\n    }\n  }\n\n  _createClass(MobileService, [{\n    key: \"getName\",\n    value: function getName() {\n      return this.data.name;\n    }\n  }, {\n    key: \"getId\",\n    value: function getId() {\n      return this.data.name;\n    }\n  }, {\n    key: \"getDescription\",\n    value: function getDescription() {\n      return this.data.description;\n    }\n  }, {\n    key: \"getLogoUrl\",\n    value: function getLogoUrl() {\n      return this.data.icon;\n    }\n  }, {\n    key: \"getIconClass\",\n    value: function getIconClass() {\n      return this.data.iconClass;\n    }\n  }, {\n    key: \"isBound\",\n    value: function isBound() {\n      return this.customResources.length > 0 && find(this.customResources, function (cr) {\n        return cr.isReady();\n      });\n    }\n  }, {\n    key: \"isBoundToApp\",\n    value: function isBoundToApp(appName) {\n      return this.customResources.length > 0 && find(this.customResources, function (cr) {\n        return cr.isReady() && cr.hasAppLabel(appName);\n      });\n    }\n  }, {\n    key: \"getCustomResourcesForApp\",\n    value: function getCustomResourcesForApp(appName) {\n      return filter(this.customResources, function (cr) {\n        return cr.hasAppLabel(appName);\n      });\n    }\n  }, {\n    key: \"getServiceInstanceName\",\n    value: function getServiceInstanceName() {\n      return this.data.name;\n    }\n  }, {\n    key: \"getSetupText\",\n    value: function getSetupText() {\n      return this.setupText;\n    }\n  }, {\n    key: \"getBindingForm\",\n    value: function getBindingForm(params) {\n      return this.customResourceClass.bindForm(params);\n    }\n  }, {\n    key: \"isBindingOperationInProgress\",\n    value: function isBindingOperationInProgress() {\n      var inprogressCR = find(this.customResources, function (cr) {\n        return cr.isInProgress();\n      });\n      return inprogressCR != null;\n    }\n  }, {\n    key: \"getBindingOperation\",\n    value: function getBindingOperation() {\n      var inprogressCR = find(this.customResources, function (cr) {\n        return cr.isInProgress();\n      });\n\n      if (inprogressCR) {\n        return inprogressCR.getCurrentOperation();\n      }\n\n      return undefined;\n    }\n  }, {\n    key: \"isBindingOperationFailed\",\n    value: function isBindingOperationFailed() {\n      var failedCR = find(this.customResources, function (cr) {\n        return cr.isFailed();\n      });\n      return failedCR != null;\n    }\n  }, {\n    key: \"isUPSService\",\n    value: function isUPSService() {\n      return this.data.type === 'push';\n    }\n  }, {\n    key: \"customResourceDef\",\n    value: function customResourceDef() {\n      return this.data.bindCustomResource;\n    }\n  }, {\n    key: \"newCustomResource\",\n    value: function newCustomResource(formdata) {\n      return this.customResourceClass.newInstance(formdata);\n    }\n  }, {\n    key: \"getConfiguration\",\n    value: function getConfiguration(appName) {\n      var _this = this;\n\n      var crs = this.getCustomResourcesForApp(appName);\n      var configurations = reduce(crs, function (all, cr) {\n        return all.concat(cr.getConfiguration(_this.data.url));\n      }, []);\n      var uniqConfigs = uniqBy(configurations, function (config) {\n        return config.label;\n      });\n      return uniqConfigs;\n    }\n  }, {\n    key: \"getConfigurationExt\",\n    value: function getConfigurationExt() {\n      return this.data.configurationExt;\n    }\n  }, {\n    key: \"getConfigurationExtAsJSON\",\n    value: function getConfigurationExtAsJSON() {\n      // configExt field example value:\n      // it is an array of annotations that start with org.aerogear.binding-ext\n      // and our annotation's value is also an array\n\n      /*\n        [\n          [\n            {\n              \"type\": \"android\",\n              \"typeLabel\": \"Android\",\n              \"url\": \"https://ups-mdc.127.0.0.1.nip.io/#/app/8936dead-7552-4b55-905c-926752c759af/variants/d6f4836a-11df-42d1-a442-e9cc823715a4\",\n              \"id\": \"d6f4836a-11df-42d1-a442-e9cc823715a4\"\n            }\n          ]\n        ]\n        */\n      if (!this.data.configurationExt || !this.data.configurationExt.length) {\n        return undefined;\n      }\n\n      var configExtItems = [];\n      var _iteratorNormalCompletion2 = true;\n      var _didIteratorError2 = false;\n      var _iteratorError2 = undefined;\n\n      try {\n        for (var _iterator2 = this.data.configurationExt[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n          var configItemStr = _step2.value;\n          var configExtItem = void 0;\n\n          try {\n            configExtItem = JSON.parse(configItemStr);\n            configExtItems.push(configExtItem);\n          } catch (err) {// not much we can do if the annotation is malformed\n          }\n        }\n      } catch (err) {\n        _didIteratorError2 = true;\n        _iteratorError2 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion2 && _iterator2.return != null) {\n            _iterator2.return();\n          }\n        } finally {\n          if (_didIteratorError2) {\n            throw _iteratorError2;\n          }\n        }\n      }\n\n      return configExtItems;\n    }\n  }, {\n    key: \"getDocumentationUrl\",\n    value: function getDocumentationUrl() {\n      return this.customResourceClass.getDocumentationUrl();\n    }\n  }, {\n    key: \"toJSON\",\n    value: function toJSON() {\n      return _objectSpread({}, this.data, {\n        configuration: this.configuration,\n        configurationExt: this.configurationExt\n      });\n    }\n  }]);\n\n  return MobileService;\n}();","map":{"version":3,"sources":["/Users/weili/work/mobile-next/golang/src/github.com/aerogear/mobile-developer-console/src/models/mobileservices/mobileservice.js"],"names":["find","filter","reduce","uniqBy","newCustomResource","newCustomResourceClass","MobileService","json","data","configuration","configurationExt","setupText","bindCustomResource","customResourceClass","kind","customResources","customResource","push","name","description","icon","iconClass","length","cr","isReady","appName","hasAppLabel","params","bindForm","inprogressCR","isInProgress","getCurrentOperation","undefined","failedCR","isFailed","type","formdata","newInstance","crs","getCustomResourcesForApp","configurations","all","concat","getConfiguration","url","uniqConfigs","config","label","configExtItems","configItemStr","configExtItem","JSON","parse","err","getDocumentationUrl"],"mappings":"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","sourcesContent":["import { find, filter, reduce, uniqBy } from 'lodash-es';\nimport { newCustomResource, newCustomResourceClass } from './customresourcefactory';\n\nexport class MobileService {\n  constructor(json = {}) {\n    this.data = json;\n    this.configuration = this.data.configuration || [];\n    this.configurationExt = this.data.configurationExt || [];\n    this.setupText = '';\n\n    if (this.data.bindCustomResource) {\n      this.customResourceClass = newCustomResourceClass(this.data.bindCustomResource.kind);\n    }\n\n    this.customResources = [];\n    if (this.data.customResources) {\n      for (const customResource of this.data.customResources) {\n        this.customResources.push(newCustomResource(customResource));\n      }\n    }\n  }\n\n  getName() {\n    return this.data.name;\n  }\n\n  getId() {\n    return this.data.name;\n  }\n\n  getDescription() {\n    return this.data.description;\n  }\n\n  getLogoUrl() {\n    return this.data.icon;\n  }\n\n  getIconClass() {\n    return this.data.iconClass;\n  }\n\n  isBound() {\n    return this.customResources.length > 0 && find(this.customResources, cr => cr.isReady());\n  }\n\n  isBoundToApp(appName) {\n    return this.customResources.length > 0 && find(this.customResources, cr => cr.isReady() && cr.hasAppLabel(appName));\n  }\n\n  getCustomResourcesForApp(appName) {\n    return filter(this.customResources, cr => cr.hasAppLabel(appName));\n  }\n\n  getServiceInstanceName() {\n    return this.data.name;\n  }\n\n  getSetupText() {\n    return this.setupText;\n  }\n\n  getBindingForm(params) {\n    return this.customResourceClass.bindForm(params);\n  }\n\n  isBindingOperationInProgress() {\n    const inprogressCR = find(this.customResources, cr => cr.isInProgress());\n    return inprogressCR != null;\n  }\n\n  getBindingOperation() {\n    const inprogressCR = find(this.customResources, cr => cr.isInProgress());\n    if (inprogressCR) {\n      return inprogressCR.getCurrentOperation();\n    }\n    return undefined;\n  }\n\n  isBindingOperationFailed() {\n    const failedCR = find(this.customResources, cr => cr.isFailed());\n    return failedCR != null;\n  }\n\n  isUPSService() {\n    return this.data.type === 'push';\n  }\n\n  customResourceDef() {\n    return this.data.bindCustomResource;\n  }\n\n  newCustomResource(formdata) {\n    return this.customResourceClass.newInstance(formdata);\n  }\n\n  getConfiguration(appName) {\n    const crs = this.getCustomResourcesForApp(appName);\n    const configurations = reduce(crs, (all, cr) => all.concat(cr.getConfiguration(this.data.url)), []);\n    const uniqConfigs = uniqBy(configurations, config => config.label);\n    return uniqConfigs;\n  }\n\n  getConfigurationExt() {\n    return this.data.configurationExt;\n  }\n\n  getConfigurationExtAsJSON() {\n    // configExt field example value:\n    // it is an array of annotations that start with org.aerogear.binding-ext\n    // and our annotation's value is also an array\n    /*\n      [\n        [\n          {\n            \"type\": \"android\",\n            \"typeLabel\": \"Android\",\n            \"url\": \"https://ups-mdc.127.0.0.1.nip.io/#/app/8936dead-7552-4b55-905c-926752c759af/variants/d6f4836a-11df-42d1-a442-e9cc823715a4\",\n            \"id\": \"d6f4836a-11df-42d1-a442-e9cc823715a4\"\n          }\n        ]\n      ]\n      */\n    if (!this.data.configurationExt || !this.data.configurationExt.length) {\n      return undefined;\n    }\n\n    const configExtItems = [];\n\n    for (const configItemStr of this.data.configurationExt) {\n      let configExtItem;\n      try {\n        configExtItem = JSON.parse(configItemStr);\n        configExtItems.push(configExtItem);\n      } catch (err) {\n        // not much we can do if the annotation is malformed\n      }\n    }\n\n    return configExtItems;\n  }\n\n  getDocumentationUrl() {\n    return this.customResourceClass.getDocumentationUrl();\n  }\n\n  toJSON() {\n    return {\n      ...this.data,\n      configuration: this.configuration,\n      configurationExt: this.configurationExt\n    };\n  }\n}\n"]},"metadata":{},"sourceType":"module"}